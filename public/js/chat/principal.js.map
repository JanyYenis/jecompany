{"version":3,"file":"/js/chat/principal.js","mappings":"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","sources":["webpack:///./resources/js/chat/principal.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst formMensaje = '#formMensaje';\r\nconst formCamara = '#formCamara';\r\nconst para = '';\r\nconst video = document.getElementById('video');\r\nconst canvas = document.getElementById('canvas');\r\nconst photo = document.getElementById('photo');\r\nconst captureButton = document.getElementById('capture');\r\n\r\n$(function () {\r\n    // generalidades.validarFormulario(formMensaje, enviarDatos);\r\n});\r\n\r\n$(document).on('click', '.btnIrChat', function(){\r\n    let contacto = $(this).attr('data-contacto');\r\n    generalidades.refrescarSeccion(null, route('chats.contacto', contacto), '.seccionChat', function(){\r\n        generalidades.validarFormulario(formMensaje, enviarDatos);\r\n        $(\"#espacioChat\").scrollTop($(\"#espacioChat\").prop(\"scrollHeight\"));\r\n        $(\".textInput\").emojiPicker();\r\n        KTMenu.createInstances();\r\n    }, false);\r\n});\r\n\r\nconst enviarDatos = (form) => {\r\n    let formData = new FormData(document.getElementById(\"formMensaje\"));\r\n    \r\n    const config = {\r\n        'method': 'POST',\r\n        'headers': {\r\n            'Accept': generalidades.CONTENT_TYPE_JSON,\r\n        },\r\n        'body': formData\r\n    }\r\n\r\n    const success = (response) => {\r\n        if (response.estado == 'success') {\r\n            $('.textInput').val('');\r\n            // generalidades.resetValidate(formMensaje);\r\n            if (response.html != undefined && response.html != '') {\r\n                $('.seccionchat').html(response.html);\r\n                $(\"#espacioChat\").scrollTop($(\"#espacioChat\").prop(\"scrollHeight\"));\r\n            }\r\n        }\r\n        // generalidades.ocultarCargando('body');\r\n        generalidades.toastrGenerico(response?.estado, response?.mensaje);\r\n    }\r\n\r\n    const error = (response) => {\r\n        // generalidades.ocultarCargando('body');\r\n        generalidades.toastrGenerico(response?.estado, response?.mensaje);\r\n    }\r\n    const ruta = route(\"chats.store\");\r\n    generalidades.create(ruta, config, success, error);\r\n    // generalidades.mostrarCargando('body');\r\n}\r\n\r\n$(document).on('shown.bs.modal', '#modalCapturarFoto', function(){\r\n    // Solicitar acceso a la cámara\r\n    $('#video').removeClass('d-none');\r\n    photo.style.display = 'none';\r\n    $('#captureOtra').addClass('d-none');\r\n    $('#enviar').addClass('d-none');\r\n    $('#capture').removeClass('d-none');\r\n    $('#mensajeInput').addClass('d-none');\r\n    iniciarCamara();\r\n    generalidades.validarFormulario(formCamara, enviarDatosCamara);\r\n});\r\n\r\n$(document).on('hidden.bs.modal', '#modalCapturarFoto', function(){\r\n    if (video.srcObject) {\r\n        let tracks = video.srcObject.getTracks();\r\n        tracks.forEach(track => track.stop());\r\n        video.srcObject = null;\r\n    }\r\n});\r\n    \r\n    // Capturar foto\r\n$(document).on('click', '#capture', function(){\r\n    $('#video').addClass('d-none');\r\n    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    photo.src = canvas.toDataURL('image/png');\r\n    photo.style.display = 'block';\r\n    $('#captureOtra').removeClass('d-none');\r\n    $('#enviar').removeClass('d-none');\r\n    $('#mensajeInput').removeClass('d-none');\r\n    $('#capture').addClass('d-none');\r\n    if (video.srcObject) {\r\n        let tracks = video.srcObject.getTracks();\r\n        tracks.forEach(track => track.stop());\r\n        video.srcObject = null;\r\n    }\r\n    console.log(canvas.toDataURL());\r\n});\r\n\r\n$(document).on('click', '#captureOtra', function(){\r\n    iniciarCamara();\r\n    $('#video').removeClass('d-none');\r\n    photo.style.display = 'none';\r\n    $('#captureOtra').addClass('d-none');\r\n    $('#enviar').addClass('d-none');\r\n    $('#mensajeInput').addClass('d-none');\r\n    $('#capture').removeClass('d-none');\r\n});\r\n\r\nconst iniciarCamara = () => {\r\n    navigator.mediaDevices.getUserMedia({ video: true })\r\n        .then(function(stream) {\r\n            video.srcObject = stream;\r\n        })\r\n        .catch(function(err) {\r\n            console.error(\"Error al acceder a la cámara: \", err);\r\n        });\r\n}\r\n\r\nconst enviarDatosCamara = (form) => {\r\n    let formData = new FormData(document.getElementById(\"formCamara\"));\r\n    formData.append('id', $('#idContacto').val());\r\n    formData.append('imagen', canvas.toDataURL());\r\n    \r\n    const config = {\r\n        'method': 'POST',\r\n        'headers': {\r\n            'Accept': generalidades.CONTENT_TYPE_JSON,\r\n        },\r\n        'body': formData\r\n    }\r\n\r\n    const success = (response) => {\r\n        if (response.estado == 'success') {\r\n            $('.textInput').val('');\r\n            $('#modalCapturarFoto .btnClose').trigger('click');\r\n            // generalidades.resetValidate(formMensaje);\r\n            if (response.html != undefined && response.html != '') {\r\n                $('.seccionchat').html(response.html);\r\n                $(\"#espacioChat\").scrollTop($(\"#espacioChat\").prop(\"scrollHeight\"));\r\n            }\r\n        }\r\n        // generalidades.ocultarCargando('body');\r\n        generalidades.toastrGenerico(response?.estado, response?.mensaje);\r\n    }\r\n\r\n    const error = (response) => {\r\n        // generalidades.ocultarCargando('body');\r\n        generalidades.toastrGenerico(response?.estado, response?.mensaje);\r\n    }\r\n    const ruta = route(\"chats.store\");\r\n    generalidades.create(ruta, config, success, error);\r\n    // generalidades.mostrarCargando('body');\r\n}\r\n\r\n$(document).on('click', '.btnGaleria', function(){\r\n    $('#idArchivo').trigger('click');\r\n});\r\n\r\n// Echo\r\nEcho.join(`chat.${window.user}`).listen('MensajeSent', (e) => {\r\n    let contacto = e?.mensaje?.de ?? 0;\r\n    if (contacto == parseInt($('#idContacto').val())) {\r\n        generalidades.refrescarSeccion(null, route('chats.contacto', contacto), '.seccionChat', function(){\r\n            generalidades.validarFormulario(formMensaje, enviarDatos);\r\n            $(\"#espacioChat\").scrollTop($(\"#espacioChat\").prop(\"scrollHeight\"));\r\n            $(\".textInput\").emojiPicker();\r\n            KTMenu.createInstances();\r\n        }, false);\r\n    }\r\n}).here(users => {\r\n    console.log(users, window.user);\r\n    let result = users.filter(user => user.id != window.user);\r\n    if (result.length > 0) {\r\n        $('.iconEstado').addClass('badge-success').removeClass('badge-danger');\r\n        $('.textoEstado').text('Activo');\r\n    }\r\n}).joining(user => {\r\n    console.log('2: '+user);\r\n    if (user.id != window.user) {\r\n        $('.iconEstado').addClass('badge-success').removeClass('badge-danger');\r\n        $('.textoEstado').text('Activo');\r\n    }\r\n}).leaving(user => {\r\n    console.log('3: '+user);\r\n    if (user.id != window.user) {\r\n        $('.iconEstado').addClass('badge-danger').removeClass('badge-success');\r\n        $('.textoEstado').text('Inactivo');\r\n    }\r\n});"],"names":["formMensaje","video","document","getElementById","canvas","photo","$","on","contacto","this","attr","generalidades","refrescarSeccion","route","validarFormulario","enviarDatos","scrollTop","prop","emojiPicker","KTMenu","createInstances","form","formData","FormData","config","CONTENT_TYPE_JSON","ruta","create","response","estado","val","undefined","html","toastrGenerico","mensaje","removeClass","style","display","addClass","iniciarCamara","enviarDatosCamara","srcObject","getTracks","forEach","track","stop","getContext","drawImage","width","height","src","toDataURL","console","log","navigator","mediaDevices","getUserMedia","then","stream","err","error","append","trigger","Echo","join","concat","window","user","listen","e","_e$mensaje$de","_e$mensaje","de","parseInt","here","users","filter","id","length","text","joining","leaving"],"sourceRoot":""}